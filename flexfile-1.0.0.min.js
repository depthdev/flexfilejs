/*
 FlexFile v1.0.0
 (c) 2015 Depth Development. http://depthdev.com
 License: MIT
*/

"use strict";function FlexFile(e){var t=function(e){return document.querySelector(e)},r=[],n=[],o=new FileReader,i=0,a=0,l=e.readAs||"DataURL",s=e.multiple===!1?!1:!0;if(!e.dropListener&&!e.fileListener)throw'ERROR: No "fileListener" and/or "dropListener" property provided for FlexFile.';var u=function(){e.abort&&e.abort(),e.fileListener&&(t(e.fileListener).value=null)},f=function(){e.complete&&e.complete(s?r:r[0],s?n:n[0],a,i)},d=function(){a++,e.status&&e.status(a,i),a!==i?w():f()},c=function(t){t.target.error&&e.error&&e.error(t.target.error)},p=function(t){var n=t.target.result;r.push(n),d(),e.load&&e.load(n)},g=e.preload?function(t){return e.preload(t)}:!1,L=function(t){e.progress&&t.lengthComputable&&e.progress(t.loaded,t.total)},v=function(){r=[],n=[],i=0,a=0,e.fileListener&&(t(e.fileListener).value=null),e.reset&&e.reset()},h=e.start||function(){},F=function(){o.abort()},b=function(){return n[0]},R=function(){return n},m=function(){return r[0]},E=function(){return r},A=function(t){if(!t.length)return!1;for(var r=[],a=t.length;a--;r.unshift(t[a]));return r=e.preload?g(s?r:r[0]):r,v(),n=Array.isArray(r)?r:[r],n.length&&n[0]?(i=n.length,o.onerror=c,o.onabort=u,o.onloadstart=h,o.onprogress=L,o.onload=p,void w()):(console.log('ERROR: Nothing was returned from the FlexFile "preload" callback.'),!1)},w=function(){o["readAs"+l](n[a])};if(e.abortListener&&t(e.abortListener).addEventListener("click",F),e.dropListener&&(t(e.dropListener).addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),t(e.dropListener).addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),A(e.dataTransfer.files)},!1)),e.fileListener){var y=t(e.fileListener);y.addEventListener("change",function(){A(this.files)},!1),s?y.setAttribute("multiple",!0):y.removeAttribute("multiple")}return{reset:v,getRawFile:b,getRawFiles:R,getFile:m,getFiles:E}}
